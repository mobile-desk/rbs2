$(document).ready(function(e) {
  var today = new Date(),
	$dynamicNumberElem = $("div.dynamic-number"),
    dynamicNumberUrl = $dynamicNumberElem.data("finalurl"),
    currentNodePath = $dynamicNumberElem.data("path");
	
	if($dynamicNumberElem.length > 0){
	
		function updateNumber(status, number) {
		  $.each($dynamicNumberElem, function(){
			  var innerText = $(this).data("text");
			  do {
				  result = innerText.substring(innerText.indexOf("${"), innerText.indexOf("}") + 1);
				  if (status === "N") {
					number = result.substring(5, result.indexOf("}"));
				  }
			
				  innerText = innerText.replace(result, number);
				} 
			while (innerText.indexOf("${dn-") != -1);
			$(this).html(innerText);
            if($(this).find('a.pop').length>0){
				globalUtil.tooltipPlugin.init();
            }
		  });
	  }

	  $.ajax({
		url: currentNodePath + ".getDynamicNumber.json?dn&" + today.getTime(),
		type: "GET",
		data: dynamicNumberUrl,
		success: function(responseText) {
		  var number = responseText.split(",");
		  if (number[1] === "Y") {
			updateNumber("Y", number[0]);
		  } else {		  
			updateNumber("N", "");
		  }
		},
		error: function(responseText) {      
		  updateNumber("N", "");
		}
	  });  
	}
  
  
});
