$.extend($.expr[':'], {
    tabbable: function(el, index, selector){
      return $(el).is('a, button, :input, [tabindex]');
    }
});
/*
* IA Header Navigation
*/
(function(){
	var iaHeaderNav = {
		ui:{},
		classes:{},
		l3Open : function(that) { // Opening l3 menu on clicking L2 menu Items
			// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
            //     that.addClass('dropdown-up-arrow-l2');
            // }
			iaHeaderNav.actives();
			
			if (that.parent().hasClass(iaHeaderNav.classes.iaactive) && (!$(".iah__container .iah__l2__main-links .iah__nav-l2").hasClass("l2opened"))) {
			  iaHeaderNav.l3Close();
			  return;
			}
			$l2Active
			  .removeClass(iaHeaderNav.classes.iaactive)
			  .children("a")
			  .attr("aria-expanded", "false");
			  if((!$l2Active.length && deviceWidth > 1023) || (!$iambActive.length && deviceWidth < 1024)){
				iaHeaderNav.tabIndexIa('add');
			  }
			  if($l3Active.length){
				iaHeaderNav.l4Close();
			  }
			that
			  .attr("aria-expanded", "true")
			  .parent()
			  .addClass(iaHeaderNav.classes.iaactive);
			if (deviceWidth <= 1023) {
			  iaHeaderNav.ui.l2MainNav.css("left", "-100%");
			  iaHeaderNav.ui.l2Item.each(function () {
				$(this).attr('tabindex', '-1');
			  });
			  iaHeaderNav.ui.l2MainNav.addClass("ia-l3-visible");
			  that.parent().find('.ia-l2-active a').attr("aria-expanded", "true");
			}
			if ($('.iah__premium').length) {
			  $(".iah__premium .iah__nav-l4").css("top", "-1px");
			  that
				.parent()
				.find(".ia__navbar-nav__l3>li")
				.first()
				.addClass(iaHeaderNav.classes.activel3)
				.find('a.iah__l4-column-title')
				.attr("aria-expanded", "true");
			  if (deviceWidth <= 1023) {
					iaHeaderNav.ui.l2MainNav.addClass("ia-l4-visible");
				}
			}
			//code to open direct l4 links when the "show l4 links" checkbox is checked
			if ($('.hide-l3').length) {
				$(".hide-l3 .iah__nav-l4").css("top", "-1px");
				that
					.parent()
					.find(".ia__navbar-nav__l3 li.show__levelfour")
					.first()
					.addClass(iaHeaderNav.classes.activel3)
					.find('a.iah__l4-column-title')
					.attr("aria-expanded", "true");
				that
					.parent()
					.find(".ia__navbar-nav__l3 li.show__levelfour > a").attr("tabindex", "-1").attr("aria-hidden", "true");
				if (deviceWidth <= 1023) {
					iaHeaderNav.ui.l2MainNav.addClass("ia-l4-visible");
                }
                if (iaHeaderNav.isSmallMedium() && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()) {
                    var height_l3_hide = Number($(".horizontal-view .ia-active .iah__nav-l4:visible").height());
                    if(deviceWidth < 768) {
                        height_l3_hide += 142;
                    }		
                    else if(deviceWidth >= 768 && deviceWidth <= 1023) {
                        height_l3_hide += 160;
                    }
                    height_l1 = Number($('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__l1').height())
                    if (height_l1 < height_l3_hide) {
                        $('.horizontal-view .iah__l1__l2__holder .iah__l1').height(height_l3_hide + "px");
                    }
                    else {
                        $('.horizontal-view .iah__l1__l2__holder .iah__l1').height(height_l1 + "px");
                    }
                }
                
			}
			if(($('.hide-l3').length === 0) && (iaHeaderNav.isSmallMedium()) && (iaHeaderNav.getBrand() === "natwest" ) && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){ // adding code for l3 let side border(L1 nav changes)
				var height_l3 = Number($(".horizontal-view .ia-active .iah__nav-l3:visible").height());
                if(deviceWidth < 768) {
                    height_l3 += 142;
                }		
                else if(deviceWidth >= 768 && deviceWidth <= 1023) {
                    height_l3 += 160;
                }
				height_l1=Number($('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__l1').height())	
                if(height_l1<height_l3)	
                    {			
                $('.horizontal-view .iah__l1__l2__holder .iah__l1').height(height_l3+"px");
                }
                else{
                $('.horizontal-view .iah__l1__l2__holder .iah__l1').height(height_l1+"px");}
			}
			
            
			
		},
		l4Open : function(that) { // Opening l4 menu on clicking L3 menu Items
			// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
            //     that.addClass('dropdown-up-arrow-l3');
            //     iaHeaderNav.ui.wrap.find('.ia__navbar-nav__l2>li.ia-active>a>span').addClass('remove-underline');
            // }
			iaHeaderNav.actives();
			if (that.parent().hasClass(iaHeaderNav.classes.activel3) && (!$(".iah__container .iah__l2__main-links .iah__nav-l2").hasClass("l2opened"))) {
			  iaHeaderNav.l4Close();
			  return;
			}
			$l3Active
			  .removeClass(iaHeaderNav.classes.activel3)
			  .children("a")
			  .attr("aria-expanded", "false");
			that
			  .attr("aria-expanded", "true")
			  .parent()
			  .addClass(iaHeaderNav.classes.activel3);
			if (deviceWidth <= 1023 && that.siblings().length > 0) {
				iaHeaderNav.ui.l2MainNav
					.css("left", "-200%")
					.addClass("ia-l4-visible")
					.removeClass("ial3actvie-onL4");
				that.parent().find('a.iah__l4-column-title').attr("aria-expanded", "true");
			  $('.ia__navbar-nav__l3 > li > a').each(function () {
				$(this).attr('tabindex', '-1');
			  });
			}
			if(iaHeaderNav.isSmallMedium()){ // adding code for l4 left side border(L1 nav changes)
				var height_l4 = Number($(".horizontal-view .active-l3 .iah__nav-l4:visible").height());
                if(deviceWidth < 768) {
                    height_l4 += 142;
                }		
                else if(deviceWidth >= 768 && deviceWidth <= 1023) {
                    height_l4 += 160;
                }
				height_l1=Number($('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__l1').height())	
                if(height_l1<height_l4)	
                    {			
                $('.horizontal-view .iah__l1__l2__holder .iah__l1').height(height_l4+"px");
                }
                else{
				$('.horizontal-view .iah__l1__l2__holder .iah__l1').height(height_l1+"px");}
				
			}
			if (deviceWidth >= 1024) {
				var l3navActive = $('.ia-active .iah__nav-l3 .iah__container .ia__navbar-nav__l3 .active-l3');
				var l3loop = l3navActive.closest('.ia__navbar-nav__l3').find('.iah__l3-column-holder');
				var counter = 0;
				for (var i=0; i< l3loop.length; i++){
	   				if( $(l3loop[i]).offset().top <=120){	
		   				$('.iah .iah__l2 nav li .iah__nav-l3 .ia__navbar-nav__l3 > li.active-l3 .iah__nav-l4').css('top','60px');
						if($(l3loop[i]).hasClass('active-l3')){	
							counter = counter + 1;
                        }
	   				}	
					else{	
						if(counter == 0){
							$(l3loop[i]).find('a').css('z-index','999');
							$(l3loop[i]).find('.chevron-wrapper').css('z-index','999');
                            $('.iah .iah__l2 nav li .iah__nav-l3 .ia__navbar-nav__l3 > li.active-l3 .iah__nav-l4').css('top','120px');
                        }
                        else{
							$(l3loop[i]).find('a').css('z-index','-1');
							$(l3loop[i]).find('.chevron-wrapper').css('z-index','-1');
                        }
					}	
				}
			}
			
		},
		l3Close : function() { // Triggering Menu Close
			// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
            //     $('.iah .ia__nav.ia__navbar-nav__l2>li').find(">a[data-level='l2']").removeClass('dropdown-up-arrow-l2');
            // }
			if( iaHeaderNav.isSmallMedium() && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){ //L1 nav mobile design
				$('.horizontal-view .iah__l1__l2__holder .iah__l1').height("100%");
			}
			iaHeaderNav.actives();
			$l2Active.find('.ia-l2-active a').attr("aria-expanded", "false");
			$(".ia-active .chevron-icon").each(function() {
				$(this).attr("aria-label", $(this).closest(".chevron-wrapper").siblings("a").text() + " submenu collapsed");
			});
			$l2Active
			  .removeClass(iaHeaderNav.classes.iaactive)
			  .children("a")
			  .attr("aria-expanded", "false");
			  $(".haslink>a").removeAttr("aria-expanded");
			if (deviceWidth >= 1024) {
				iaHeaderNav.tabIndexIa('restore');
			}
			if ($l3Active.length > 0 && deviceWidth >= 1024) {
				iaHeaderNav.l4Close();
			}
			iaHeaderNav.overlayController();
			if (deviceWidth <= 1023) {
			  iaHeaderNav.ui.l2MainNav.css("left", "0").removeClass("ia-l3-visible").removeClass("ia-l4-visible").removeClass("ial3actvie-onL4");
			  $('.ia__navbar-nav__l2 li').find('a').removeAttr('tabindex');
			}
			setTimeout(function() {
				$(".chevron-icon").removeClass("dropdown-opened");
			}, 200);
		},
		l4Close : function() { // Triggering L4 Close
			// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
            //     iaHeaderNav.ui.wrap.find('.ia__navbar-nav__l2>li>a>span').removeClass('remove-underline');
            //     $('.iah .ia__nav.ia__navbar-nav__l3>li').find(">a[data-level='l3']").removeClass('dropdown-up-arrow-l3');
            // }
			if( iaHeaderNav.isSmallMedium() && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){ //L1 nav mobile design
				$('.horizontal-view .iah__l1__l2__holder .iah__l1').height("100%");
			}
			iaHeaderNav.actives();
			var l3activemenu=$(".iah__l3-column-holder.haslink.active-l3>a");
			l3activemenu.siblings(".chevron-wrapper").find(".chevron-icon").attr("aria-label", l3activemenu.text() + " submenu collapsed");
			$l3Active
			  .removeClass(iaHeaderNav.classes.activel3)
			  .children("a")
			  .attr("aria-expanded", "false");
			if (deviceWidth <= 1023) {
			  if (!$(".iah__nav-l2.iah__premium").length > 0) {
				$('.ia__navbar-nav__l3 > li > a').each(function () {
				  $(this).removeAttr('tabindex');
				});
				iaHeaderNav.ui.l2MainNav.css("left", "-100%").removeClass("ia-l4-visible").addClass("ia-l3-visible ial3actvie-onL4");
			  } else {
				$('.ia__navbar-nav__l2 li').find('a').removeAttr('tabindex');
				$l2Active
				  .removeClass(iaHeaderNav.classes.iaactive)
				  .children("a")
				  .attr("aria-expanded", "false");
				iaHeaderNav.ui.l2MainNav.css("left", "0").removeClass("ia-l4-visible").removeClass("ia-l3-visible").removeClass("ial3actvie-onL4");
			  }
			  //remove tabindex for the unfocusable elements when the page navigates to previous level
				$(".ia__navbar-nav__l2 > li.ia-active").each(function () {
					if (!$(this).hasClass("hide-l3")) {
						$(this).find('.ia__navbar-nav__l3 > li > a').each(function () {
							$(this).removeAttr('tabindex');
						});
						iaHeaderNav.ui.l2MainNav.css("left", "-100%").removeClass("ia-l4-visible").addClass("ia-l3-visible ial3actvie-onL4");
					} else {
						$(this).find('a').removeAttr('tabindex');
						$l2Active
							.removeClass(iaHeaderNav.classes.iaactive)
							.children("a")
							.attr("aria-expanded", "false");
						iaHeaderNav.ui.l2MainNav.css("left", "0").removeClass("ia-l4-visible").removeClass("ia-l3-visible").removeClass("ial3actvie-onL4");
					}
				})
			}
			if (deviceWidth >= 1024) {
				var l3loop = $('.iah__nav-l3 .iah__container .ia__navbar-nav__l3 .iah__l3-column-holder');				
				for (var i=0; i< l3loop.length; i++){
				$(l3loop[i]).find('a').css('z-index','999');
				}
			}
			setTimeout(function() {
				$(".chevron-icon").removeClass("dropdown-opened");
			}, 200);
		},
		l2To3Handeler : function(e) { // On Clicking L2 Items activating menu if menu is available or redirecting to link location
			var $hasSubNav = $(this).siblings().find('ul li').length > 0;
			var thisele=$(this);
			if (!$hasSubNav && e.type=="mouseenter") {
				iaHeaderNav.l3Close();
			}
			if($hasSubNav) {
				if((e.type=="keyup" && e.keyCode==13 && window.innerWidth>=1024) || (e.type=="click" && ($(this).attr("href")=="#") || ($(this).attr("href")=="javascript:void(0)") && window.innerWidth>=1024 && $("html").hasClass("responsive_natwest_group")) || (e.type=="click" && window.innerWidth<1024) || (e.type=="click" && (!$("html").hasClass("responsive_natwest_group")))) {
					iaHeaderNav.l3Open($(this));
					iaHeaderNav.overlayController();
					iaHeaderNav.l4SideBorderquilizer();
				}
                if(e.type=="mouseenter" && window.innerWidth>=1024) {
					$(".iah__container .iah__l2__main-links .iah__nav-l2").addClass("l2opened");
					iaHeaderNav.l2TimeOutTime = 0;
					iaHeaderNav.l2TimeOut = setTimeout(function() {
						if($(".iah__container .iah__l2__main-links .iah__nav-l2").hasClass("l2opened")) {
							iaHeaderNav.l3Open(thisele);
							iaHeaderNav.overlayController();
							iaHeaderNav.l4SideBorderquilizer();
						}
					}, 400);
				}
				
			}
			// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
            //     setTimeout(function () {
            //         $('.iah .ia__nav.ia__navbar-nav__l2>li:not(.ia-active)').each(function () {
            //             if ($(this).find('.ia__navbar-nav__l3 > li').length) {
            //                 $(this).find(">a[data-level='l2']").removeClass('dropdown-up-arrow-l2');
            //                 $(this).find(">a[data-level='l2']").addClass('dropdown-arrow-l2');
            //             }
            //         });
            //     }, 400);
            // }
		},
		l3To4Handeler : function(e) { // On Clicking L3 Items opening L4 menu if menu is available or redirecting to link location
			var $hasSubNav = $(this).siblings().find('ul li').length > 0;
			var thisele=$(this);
			if (!$hasSubNav && e.type=="mouseenter") {
				iaHeaderNav.l4Close();
			}
			if($hasSubNav) {
				if((e.type=="keyup" && e.keyCode==13 && window.innerWidth>=1024) || (e.type=="click" && ($(this).attr("href")=="#") || ($(this).attr("href")=="javascript:void(0)") && window.innerWidth>=1024 && $("html").hasClass("responsive_natwest_group")) || (e.type=="click" && window.innerWidth<1024) || (e.type=="click" && (!$("html").hasClass("responsive_natwest_group")))) {
					iaHeaderNav.l4Open($(this));
					iaHeaderNav.l4SideBorderquilizer();
				}
                if(e.type=="mouseenter" && window.innerWidth>=1024) {
                    iaHeaderNav.l3TimeOutTime = 0;
                    iaHeaderNav.l3TimeOut = setTimeout(function() {
                        iaHeaderNav.l3TimeOutTime = 400;
                        iaHeaderNav.l4Open(thisele);
						iaHeaderNav.l4SideBorderquilizer();
                    }, 400);
                }
			}
			// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
            //     setTimeout(function () {
            //         $('.iah .ia__nav.ia__navbar-nav__l3>li:not(.active-l3)').each(function () {
            //         	if ($(this).find('.ia__navbar-nav__l4 > li').length) {
            //             	$(this).find(">a[data-level='l3']").removeClass('dropdown-up-arrow-l3');
            //             	$(this).find(">a[data-level='l3']").addClass('dropdown-arrow-l3');
            // 	    	}
            //     	});
            //     }, 400);
            // }
		},
		closemenu: function(e) {
				// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
				// 	if (e.type == 'click' && $(this).attr("href") != undefined) {
				// 		window.location.href = $(this).attr("href");
				// 	} else if (e.type == 'click' && $(this).attr("href") == undefined) {
				// 		if ($(this).hasClass('dropdown-arrow-l3') || $(this).hasClass('dropdown-up-arrow-l3') ) {
				// 			$(this).removeClass('dropdown-arrow-l3');
				// 			$(this).addClass('dropdown-up-arrow-l3');
				// 		}
				// 	}
				// } else {
					var $hasSubNav = $(this).siblings().find('ul li').length > 0;
					if (!$hasSubNav && e.type=="click") {
						window.location.href = $(this).attr("href");
						return;
					}
				// }
		},
		overlayController : function() { // Toggleing overlay when need
			if (
			  ($(".ia__navbar-nav__l2>.ia-active").length > 0 &&
				window.innerWidth >= 1024) ||
			  ($(".iah__l2 .iah__l2__main-links.ia__mb-active").length > 0 &&
				window.innerWidth <= 1023)) {
			  $(".iah").addClass(iaHeaderNav.classes.iahoverlayactive);
				$("html").addClass(iaHeaderNav.classes.iatogglescroll);
				if( (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){ //for opening l1 nav from top, l1 nav changes 
                    $('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder').scrollTop(0);
                }
                else{
                    $('body,html').scrollTop(0);
                }                          
			} else {
			  $(".iah").removeClass(iaHeaderNav.classes.iahoverlayactive);
			  $("html").removeClass(iaHeaderNav.classes.iatogglescroll);
			}
		},
		mousehoverAnimation : function(){ // closing menu if mouse left the menu or clicked outside the menu
			var timeOut;
			function stopHide() {
			  clearTimeout(timeOut);
			}
			function startHide() {iaHeaderNav.actives();
			  timeOut = setTimeout(function () {
				if($('html').hasClass('mouse')){
					$(".iah__container .iah__l2__main-links .iah__nav-l2").removeClass("l2opened");
					iaHeaderNav.l3Close();
				}
			  }, 200);
			}			
			if (deviceWidth > 1023) {
				$(".iah__container .iah__l2__main-links .iah__nav-l2").on("mouseenter", stopHide), $(".iah__container .iah__l2__main-links .iah__nav-l2").on("mouseleave", startHide);
			}
			$(document).on("click touchstart", function (e) {
			  var $holders = $(".iah__l1__l2__holder , .iah .iah__container .iah__l2__main-links .iah__menu-link, .iah__l2__main-links.ia__mb-active > div:nth-child(2),.lah__search__show,.loginbus");
			  if (!iaHeaderNav.ui.nav.is(e.target) && iaHeaderNav.ui.nav.has(e.target).length === 0 && deviceWidth >= 1024 && $('.iah__nav-l2 .ia-active').length > 0) {
				iaHeaderNav.l3Close();
			  }if (!$holders.is(e.target) && $holders.has(e.target).length === 0 && deviceWidth <= 1023 && $(".ia__mb-active").length > 0){
				iaHeaderNav.mobileMenuHandler();
			  }
			});
		},
		l4SideBorderquilizer : function(){
			var arr = [],
			arrExplore = [],
			arrExploreAll = [],
			  borderHeight;
			  
			$(".active-l3 .iah__l4-column-holder").each(function () {
			  arr.push($(this).height());
			});
			borderHeight = Math.max.apply(this, arr) + "px";
			if ($(".active-l3 .iah__l4-column-holder").find('.iah__l4-column-explore').length > 0){
                var webType = $('.iah--adaptive').length? 52 : 36;
				$(".active-l3 .iah__l4-column-holder").each(function () {
                    if ($(this).attr('style') == undefined){
                         if($(this).find('.iah__l4-column-explore').closest('.iah__l4-column-holder').height()!=undefined){
                            arrExplore.push($(this).find('.iah__l4-column-explore').closest('.iah__l4-column-holder').height() + webType);
                         }
                         else{
                            arrExplore.push(webType);
                         }
				  		
                    }
				});
				arrExploreAll = arr.concat(arrExplore);
				borderHeight = Math.max.apply(this, arrExploreAll) + "px";

			}
			$(".active-l3 .iah__l4-column-holder").each(function () {
			  $(this).css("height", borderHeight);
			});
		},
		mobileMenuHandler : function(){ // toggling mobile menu on clicking hamburger in mobile
			if ($(".iah__l2 .iah__l2__main-links.ia__mb-active").length) {
			  iaHeaderNav.tabIndexIa('restore');
			  iaHeaderNav.l3Close();
			  setTimeout(function() {
				  $('.mobile__hamburger .iah__menu-link').focus();
			  }, 100);
			  setTimeout(function() {
				  $('.mobile__hamburger .iah__menu-link').attr("aria-expanded", "false");
			  }, 300);
			  $('.iah__menu-link')
				.parents(".iah__l2__main-links")
				.removeClass(iaHeaderNav.classes.iambactive);
			  iaHeaderNav.ui.l2MainNav.css("left", "100%");
			} else {
				setTimeout(function() {
					$('.iah__l1__l2__holder .iah__menu-link').focus();
				}, 100);
				setTimeout(function() {
					$('.iah__l1__l2__holder .iah__menu-link').attr("aria-expanded", "true");
				}, 400);
				setTimeout(function() {
                $('.iah__menu-link').removeAttr("aria-expanded");
                    $(".ia-active a").focus();
                }, 800);
				$('.iah__menu-link')
				.parents(".iah__l2__main-links")
				.addClass(iaHeaderNav.classes.iambactive);
			  iaHeaderNav.ui.l2MainNav.css("left", "0");
			  iaHeaderNav.tabIndexIa('add');
			}
			iaHeaderNav.overlayController();
			if ($('.iah__search[style*=calc]').length || $('.bussiness__login--mobile[style*=calc]').length) {
				iaHeaderNav.slBack();
			}
		},
		searchToggler : function(){ // closing menu on clicking on search
			if (deviceWidth >= 1024) {
			  iaHeaderNav.l3Close();
			}
		},
		activeClassesHandler : function(){
			iaHeaderNav.actives();
			if (deviceWidth <= 1023 && $(".ia__navbar-nav__l2>li.ia-active").length > 0) {
			  $l2Active
				.removeClass(iaHeaderNav.classes.iaactive)
				.children("a")
				.attr("aria-expanded", "false");
			} else {
			  if ($l2Active.length > 0) {
				$l2Active.siblings().show();
			  }
			}
		},
		activatingL1 : function(){ // activating l1 based on brand
			var navBrand = $("#navigationTag").val().split("/")[1];
			$(".iah__l1 .ia__nav li a").each(function () {
			  
				if ($(this).attr("data-navid") === navBrand) {
				 $(this)
						.parent()
						.addClass(iaHeaderNav.classes.iaactive)
						.attr("aria-current", "true");
				$(this).parent().find("a").attr("aria-current", "page");
				} else {
					$(this).parent().removeClass(iaHeaderNav.classes.iaactive);
				}
			  });
			  if (deviceWidth <= 1023) {
				$(".iah__product-title").each(function () {
					if ($(this).attr("data-navid") === navBrand) {
						$(this).show().siblings("[data-navid]").hide().attr("aria-hidden", "true");
					}
					
				});				
			}
		},
		slideBackl3l4 : function(){
			var $l4ColTitle = $(".iah__l4-column-holder:first-child .iah__l4-column-title"),
				$l3ColTitle = $(".iah__l1__l2__holder .iah__nav-l2 .ia__navbar-nav__l2 .iah__nav-l3 .ia-l2-active > a");
			$l4ColTitle.on("click keyup", function (e) {
				if((e.type=="click" || e.keyCode==13) && window.innerWidth <= 1023) {
					var parentL3 = $(this).parents('.active-l3');
					$(this).attr("aria-expanded", "false");
					iaHeaderNav.l4Close();
					parentL3.children('a').focus();
				}
			});
			$l3ColTitle.on("click", function () {
				var parentL2 = $(this).parents('.ia-active');
				$(this).attr("aria-expanded", "false");
				iaHeaderNav.l3Close();
				parentL2.children('a').focus();
			});
		},
		slBack : function(){
			var horizontalViewShow = $('.horizontal-view .lah__search__show');
			horizonatlViewBrandlogo = $('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .header-top-mobile .brand-logo');
			if ($('.iah__search[style*=calc]').length) {
				$('.iah__l2.height-iah-error').removeClass('height-iah-error').find('form.empty-input-error').removeClass('empty-input-error');
				$(".lah__search__show button.iah__btn__tabs").attr("aria-expanded", "false").focus();
			}
			$('.iah__search[style*=calc], .bussiness__login--mobile[style*=calc]').css({
				height: "0",
				visibility: "hidden"
			});
			$('.iah__mb__search').find('.iah__btn__tabs').removeAttr('tabindex');
			$(".lah__search__show").css("bottom", "0");
			// added code for search and login button, l1 nav changes
			horizontalViewShow.css("bottom", "");
            $(".horizontal-view .iah__mb__search .iah__mb__login").css("display","block");            
            $(".horizontal-view .iah__btn__tabs_wrap").css("max-width",""); 
			$(".horizontal-view .iah__mb__search .iah__search-tab").css("width","");
			$(".horizontal-view .iah__mb__search .iah__btn__tabs").css({"width":"", display:""});
			$('.iah__nav-l2 .ia__navbar-nav__l2 > li > a').each(function () {
				$(this).removeAttr('tabindex')
			});
			if ($('.bussiness__login--mobile[style*=calc]').length) {
				$(".lah__search__show a.iah__btn__tabs").attr("aria-expanded", "false").focus();
			}
			$('.iah__l1__l2__holder').removeAttr('style');
			//added code for buttons and borders in seacrh and login screen
			horizontalViewShow.removeClass('searchhide loginborderhide');			
            $('.horizontal-view .iah__search-tab').removeClass('loginborder');
            
			 $('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__l1').removeClass('hide_L1');
			 $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .iah__mobile-logintitle').removeClass('hide_login');
			 $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .back-to-menu').removeClass('hideborder');
             
             //$('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .iah__search').css('border-left', 'none');
             horizonatlViewBrandlogo.removeClass('searchborder_ipad');
             if(deviceWidth<768 && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){
                horizonatlViewBrandlogo.css('border-right', '');
            }
            if(deviceWidth<1024 && deviceWidth>=768 && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){              
                horizonatlViewBrandlogo.addClass('borderadd');
            }
			$(".iah__l1__l2__holder, .lah__search__show").attr("aria-hidden", "false");
		},
		slActive : function(){
			var horizontalViewShow = $('.horizontal-view .lah__search__show');
			horizonatlViewBrandlogo = $('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .header-top-mobile .brand-logo'); 
			iaHeaderNav.actives();
			$('.iah__l1__l2__holder').scrollTop(0).css('overflow','hidden');
			var $dataTarget = $(this).data('target'),
				$targetDiv,
				$height_n_vlaue = $('.iah__l1__l2__holder .iah__nav-l2').offset(),
				$targetHeight = $height_n_vlaue.top;
			"search" === $dataTarget ? $targetDiv = $(".iah__search") : $targetDiv = $(".bussiness__login--mobile");
			if(!$targetDiv.find('.iah__login__dropdown').length && $dataTarget !== "search"){
				return;
			}
			//for hiding and showing buttons in login and search screen
			$dataTarget === "search" ? horizontalViewShow.addClass('searchhide') : horizontalViewShow.removeClass('searchhide');
			$dataTarget === "login" ? horizontalViewShow.addClass('loginborderhide') : horizontalViewShow.removeClass('loginborderhide');
			if(deviceWidth>768 && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()) {
				horizontalViewShow.removeClass('loginborderhide');
			}
            $dataTarget === "login" ? $('.horizontal-view .iah__search-tab').addClass('loginborder') : $('.horizontal-view .iah__search-tab').removeClass('loginborder');
            if(deviceWidth<768 && (iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){
            $dataTarget === "search" ? horizonatlViewBrandlogo.css('border-right', 'none') : horizonatlViewBrandlogo.css('border-right', '');
            }
			var loginHeight = Number($(".iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder").height() + (60));	
			$('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .iah__login__dropdown-topsection').height(loginHeight+"px");
			
			$(".lah__search__show").css("bottom", "-75px");			
             $(".horizontal-view .lah__search__show").css("bottom", "-5px");
			 $(".horizontal-view .iah__mb__search .iah__mb__login").css("display","none"); 
			 if((iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()) {
				$(".horizontal-view .iah__mb__search .iah__btn__tabs").css({"width":"calc(100% - 1px)", "display":"none"}); 
			 }
			 else{
				$(".horizontal-view .iah__mb__search .iah__btn__tabs").css("width","calc(100% - 1px)");
			 }
           
			//$(".horizontal-view .iah__btn__tabs_wrap").css("max-width","188px");
			
			$(this).attr("aria-expanded", "true").closest('.iah__mb__search').find('.iah__btn__tabs').attr('tabindex', '-1');
			if (deviceWidth <= 1023) {
				$targetDiv.css({
				height: "calc(100% - " + $targetHeight + "px)",
					visibility: "visible"
				});
			}
			setTimeout(function () {
				if (deviceWidth <= 1023 && $('.ia__navbar-nav__l2 .ia-active').length > 0) {
				iaHeaderNav.ui.l2MainNav.css("left", "0").removeClass("ia-l4-visible ia-l3-visible ial3actvie-onL4");
				if ($l2Active.length > 0 || $l3Active.length > 0) {
					iaHeaderNav.l3Close();
				}
				}
				if ($targetDiv.is(":visible")) {
				$('.iah__nav-l2 .ia__navbar-nav__l2 > li > a').each(function () {
					$(this).attr('tabindex', '-1')
				});
				return;
				}
				$('.ia__navbar-nav__l2 li').find('a').removeAttr('tabindex');
			}, 150);
			// for adding and removing border from seacrh and login screen
            if( deviceWidth<1024  &&(iaHeaderNav.getBrand() === "natwest") && ($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion()){
                $dataTarget === "search" ? $('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__l1').addClass('hide_L1') : $('.iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__l1').removeClass('hide_L1');						
                $dataTarget === "search" ? horizonatlViewBrandlogo.addClass('searchborder_ipad') :  horizonatlViewBrandlogo.removeClass('searchborder_ipad');
                $dataTarget === "search" ? $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .iah__search').css('border-left', '1px solid #67437f') : $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .iah__search').css('border-left', 'none');									            
				$dataTarget === "search" ? $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .iah__mobile-logintitle').addClass('hide_login') : $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .iah__mobile-logintitle').removeClass('hide_login');						
                $dataTarget === "search" ? $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .back-to-menu').addClass('hideborder') : $('.iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .bussiness__login--mobile .iah__login__dropdown .back-to-menu').removeClass('hideborder');						
                
            }
			setTimeout(function() {
				$(".iah__search-input").focus();
			}, 100);
			$(".iah__l1__l2__holder, .lah__search__show").attr("aria-hidden", "true");
		},
		tabIndexIa : function(toDo){
			if (toDo == 'restore'){
			  // When menu closed
			  // For each tabbable element restore saved tabindex if this exists otherwise just remove tabindex attribute.
              if(iaHeaderNav.storeTabables){
			  iaHeaderNav.storeTabables.each(function(){
				  if ($(this).attr('data-saved-tabindex')){
					  $(this).attr('tabindex', $(this).attr('data-saved-tabindex')).removeAttr('aria-hidden');
				  } else {
					  $(this).removeAttr('tabindex').removeAttr('aria-hidden');
				  }
				  // Remove aria-hidden from main content, footer and breadrumb
					  $('#main-content-wrapper, .ia__footer, #breadrumb').removeAttr('aria-hidden');
			  });
             }
			} else {
			  // When menu opened.
			  // For each tabbable element if it has a tabindex save this in another attribute then set tabindex to -1 for all of these.
              iaHeaderNav.storeTabables = $(':tabbable').not('header .iah :tabbable');
			  $(':tabbable').not('header .iah :tabbable').each(function(){
				  if ($(this).attr('tabindex')) {
					  $(this).attr('data-saved-tabindex', $(this).attr('tabindex'));
				  }
			  }).attr('tabindex', '-1').attr('aria-hidden', 'true');
			  // Make main content, footer and breadrumb have aria-hidden = true
				  $('#main-content-wrapper, .ia__footer, #breadrumb').attr('aria-hidden', 'true');
			}
		},
		skipLinks : function(e){
			if($(this).attr("data-skipto")){
				e.preventDefault();
				var skipId = $(this).attr("data-skipto"),
					$targeted_l3 = $(".iah__l2 .iah__nav-l2 a[data-skipid='"+skipId+"']"),
					$targeted_l2 = $targeted_l3.parent('li').parents('li').children('a'),
					$hasSubNav = $targeted_l3.siblings().find('ul li').length > 0;
				if($targeted_l3.parents('.iah__l2').length){
					if(!$targeted_l2.parent('li').hasClass('ia-active')){
						iaHeaderNav.l3Open($targeted_l2);
					}
					if (!$hasSubNav) {
						window.location.href = $targeted_l3.attr("href");
						return;
					}
				  iaHeaderNav.l4Open($targeted_l3);
				  $targeted_l3.focus();
				}
			}
		},
		reSize : function(){
			/* NW US Nav prod issue fix*/
			if($('#navigationTag').val() === 'nav:natwestus/us' && !iaHeaderNav.isChampion()){
				$('.search-mobile-icon').hide();
				$('.header-top-mobile, .back-to-menu').removeClass('visible-xs visible-sm').hide();
				if(window.innerWidth > 767 && window.innerWidth < 1024){
					$('.header-top-mobile + .iah__menu-link.menu-open').hide();
				}else if(window.innerWidth < 768){
					$('.header-top-mobile + .iah__menu-link.menu-open').show();
				}				
			}
			iaHeaderNav.actives();
			deviceWidth = window.innerWidth;
			if (($(document.activeElement).prop('type') === 'text' && deviceWidth <= 1023) || $('.iah__search[style*=visible]').length) {
				return;
			}
			iaHeaderNav.activeClassesHandler();
			if (deviceWidth > 1023) {
				if (!$l2Active.length) {
					if ($(".iah").hasClass(iaHeaderNav.classes.iahoverlayactive)) {
						$("html").removeClass(iaHeaderNav.classes.iatogglescroll);
						$(".iah").removeClass(iaHeaderNav.classes.iahoverlayactive);
						iaHeaderNav.tabIndexIa('restore');
					}
					$(".iah__product-title").hide();
				}
				$('.ia-l2-active').find("a[aria-expanded='true']").attr("aria-expanded", "false");
				$(".iah").find($(".iah__nav-l2 ul.ia__navbar-nav__l2>li")).show();
  				//$(".iah__search").css('visibility', "visible");
			} else {
				iaHeaderNav.activatingL1();
				if ($(".iah .iah__container .iah__l2__main-links").hasClass(iaHeaderNav.classes.iambactive)) {
					$(".iah__l2__main-links")
					.removeClass(iaHeaderNav.classes.iambactive)
					.find('.iah__menu-link')
					.removeClass(iaHeaderNav.classes.iambactive);
					iaHeaderNav.ui.l2MainNav.css("left", "100%");
				}
				if ($(".iah").hasClass(iaHeaderNav.classes.iahoverlayactive)) {
					$("html").removeClass(iaHeaderNav.classes.iatogglescroll);
					$(".iah").removeClass(iaHeaderNav.classes.iahoverlayactive);
				}
				iaHeaderNav.tabIndexIa('restore');
			}
			if(iaHeaderNav.isSmallMedium() && (iaHeaderNav.getBrand() === "natwest") && iaHeaderNav.getNavId() !== "us" || iaHeaderNav.isChampion()){// adding new class for changing L1 nav view 

			$('.ia__main-content').addClass('horizontal-view');
				if($("#navigationTag").val() === '')
				{
					$(".iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__nav-l2").addClass("errorpage");
					$(".iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .iah__search").addClass("searchheight");
				}
			}
			else{
				$('.ia__main-content').removeClass('horizontal-view');
            }
            
		},
		iaKeyEvents : function(){
			$(".ia__main-content").on("keydown", function (e) {
				var expandednav=$(".haslink.ia-active").find("a[data-level='l2']").siblings(".chevron-wrapper");
				if (e.keyCode === 27 && deviceWidth >= 1024) { // ESCAPE
					if($(".active-l3").length>0) {
						iaHeaderNav.l4Close();
					}
					else {
						iaHeaderNav.l3Close();
						if($(":focus").closest(".ia__navbar-nav__l3").length>0) {
							expandednav.attr("aria-live", "polite");
						}
						expandednav.find(".chevron-icon").focus();
						setTimeout(function() {
							expandednav.removeAttr("aria-live");
						}, 500);
					}
				}
			});
			$(".ia__main-content").on("keyup", function (e) {
				if (e.keyCode === 9 && deviceWidth >= 1024) {
					iaHeaderNav.actives();
					if ($(':focus').data('level') == 'l3' && $l3Active.length){
						iaHeaderNav.l4Close();
					}
					if (($(':focus').data('level') == 'l2' && $l2Active.length) || (!$(':focus').parents('.ia__navbar-nav__l2').length && $l2Active.length)){
						iaHeaderNav.l3Close();
					}
				}
			});
		},
		checkingDeeplinks:function(e){
			var currentpageURL = window.location.pathname, 
			hasSubmenu = $(this).siblings('.iah__nav-l4').length || $(this).siblings().find(".ia__navbar-nav__l3 li").length,
			thisHref = $(this).attr('href'),
			isDominePage = currentpageURL == '/';
			if((thisHref.indexOf('#') != -1) && (thisHref.indexOf(currentpageURL) != -1) && !hasSubmenu && !isDominePage){
				e.preventDefault();
				var shelfID = '#' + thisHref.split('#')[1];
				if(location.hash != shelfID){
					history.replaceState(undefined, undefined, shelfID); 
				}
				if($(window).width() < 1024){
					iaHeaderNav.mobileMenuHandler();
				}else{
					iaHeaderNav.l3Close();
				}
				$("html, body").animate({
					scrollTop: $(shelfID).offset().top
				},200);
			}
		},
		getNavId: function() {
			var navid = $(".iah a").attr("data-navid");
			return navid;
		},
        isChampion: function () {
            var stylesheet = $('link[rel="stylesheet"]').attr('href');
            return stylesheet.indexOf("clientlib_base_champion") > 0;
        },
		isSmallMedium: function() {
			return $(window).width() < 1024;
		},
		// brand check for experience fragment url     
		getBrand: function () {
			var brand = "",
				stylesheet = $('link[rel="stylesheet"]').attr('href');

			if ((stylesheet.indexOf("natwest-business_clientlibs") > 0) || (stylesheet.indexOf("clientlib_base_champion") > 0) || (stylesheet.indexOf("natwest-premier_clientlibs") > 0) || (stylesheet.indexOf("natwest-personal_clientlibs") > 0) || (stylesheet.indexOf("clientlib_base_nw_personal") > 0) || (stylesheet.indexOf("clientlib_base_nw_business") > 0) || (stylesheet.indexOf("clientlib_base_nw_premier") > 0)) {
				brand = "natwest";
			}
			return brand;
		},
		setClicks : function(){
			this.ui.l2andl3Selectors.on("click", function (e) {
				e.preventDefault();
			});
			this.ui.iaLinks.on("click", this.checkingDeeplinks);
			this.ui.l2Item.on("click", this.l2To3Handeler);
			this.ui.l3Item.on("click", this.l3To4Handeler);
			if(window.innerWidth>=1024) {
				this.ui.l2Item.on("mouseenter", this.l2To3Handeler);
				this.ui.l2Item.on("mouseleave", function(){
                    if(iaHeaderNav.l2TimeOutTime == 0 && window.innerWidth>=1024) {
                    clearTimeout(iaHeaderNav.l2TimeOut);
                }});
				this.ui.l3Item.on("mouseenter", this.l3To4Handeler);
                this.ui.l3Item.on("mouseleave", function(){
                    if(iaHeaderNav.l3TimeOutTime == 0 && window.innerWidth>=1024) {
                    clearTimeout(iaHeaderNav.l3TimeOut);
                }});
			}
			this.ui.l2Item.on("click", this.closemenu);
			this.ui.l3Item.on("click", this.closemenu);
			this.ui.hambergerMenu.on("click", this.mobileMenuHandler);
			this.ui.searchAreaSelector.on("click touchstart", this.searchToggler);
			this.ui.slCta.on("click", this.slActive);
			this.ui.skipLink.on("click", this.skipLinks);			
			this.slideBackl3l4();
			this.ui.loginClose.on("click", this.slBack);
			// this.ui.l4Item.on("mouseover", this.l4ItemMouseOver);
            // this.ui.l4Item.on("mouseout", this.l4ItemMouseOut);
			if((iaHeaderNav.getBrand() === "natwest") && $('#navigationTag').val() !== 'nav:natwestus/us'){// removing back option clicking on search in natwest(16280) 
                return;
            }
			else{
                this.ui.slClose.on("click", this.slBack);
            }

		},
		// l4ItemMouseOver: function () {
        //     if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
        //         iaHeaderNav.ui.wrap.find('.ia__navbar-nav__l3>li.active-l3>a>span').addClass('remove-underline');
        //     }
        // },
        // l4ItemMouseOut: function () {
        //     if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
        //         iaHeaderNav.ui.wrap.find('.ia__navbar-nav__l3>li.active-l3>a>span').removeClass('remove-underline');
        //     }
        // },
		actives : function(){
			$l2Active = $(".iah").find(".iah__nav-l2 .ia-active");
			$l3Active = $(".iah").find(".iah__nav-l2 .active-l3");
			$l2ActiveItem = $(".iah").find(".iah__nav-l2 .ia-active > a");
			$l3ActiveItem = $(".iah").find(".iah__nav-l2 .active-l3 > a");
			$iambActive = $(".iah__l2 .ia__mb-active");
		},
		setUIElements : function(){ // cache all elements on page load
			this.ui.wrap = $('header .iah');
			this.ui.l2Item = this.ui.wrap.find('.ia__navbar-nav__l2>li>a');
			this.ui.l3Item = this.ui.wrap.find('.ia__navbar-nav__l3>li>a');
			this.ui.l2MainNav = this.ui.wrap.find('.iah__nav-l2');
			this.ui.l2andl3Selectors = this.ui.wrap.find('.ia__navbar-nav__l2>li>a,.ia__navbar-nav__l3>li>a');
			this.ui.hambergerMenu = this.ui.wrap.find('.iah__menu-link');
			this.ui.nav = this.ui.wrap.find('.ia__main-content');
			this.ui.searchAreaSelector = this.ui.wrap.find('.iah__search-area');
			this.ui.slCta = this.ui.wrap.find('.lah__search__show .iah__btn__tabs');
			this.ui.skipLink = this.ui.wrap.find('.skip-links a');
			this.ui.slClose = this.ui.wrap.find('.iah-search-title');
			this.ui.iaLinks = this.ui.wrap.find('.iah__l1, .iah__l2').find('a[href]');
			this.ui.loginClose = this.ui.wrap.find('.back-to-menu-link');
			deviceWidth = window.innerWidth;
			this.ui.l4Item = this.ui.wrap.find('.iah__nav-l4 .ia__nav.ia__navbar-nav__l4 .iah__l4-top>ol>li>a');
			// Class Names
			this.classes.iambactive = "ia__mb-active";
			this.classes.iaactive = "ia-active";
			this.classes.activel3 = "active-l3";
			this.classes.iahnavl3 = ".iah__nav-l3";
			this.classes.iahoverlayactive = "iah__overlay--active";
			this.classes.iatogglescroll = "ia-toggle-scroll";
            this.storeTabables = null;
			this.l2TimeOut = "";
            this.l2TimeOutTime = -1;
            this.l3TimeOut = "";
            this.l3TimeOutTime = -1;
		},
		init : function(){ // initialize IA Header Navigation
			this.setUIElements(); // cache all required selectors
			this.getBrand();
			this.getNavId();
			this.isSmallMedium();
			this.setClicks(); // provideing all click events
			this.overlayController();
			this.mousehoverAnimation();
			this.activatingL1(); // activating l1 based on brand
			this.actives();
			this.iaKeyEvents();			
			if (window.innerWidth >= 1024) {
				$('.iah a.iah__l4-column-title').attr('tabindex', '-1');
			}
			$(document).keydown(function(e) {
				if($('html').hasClass('keyboard')){return;}
				$('html').addClass('keyboard').removeClass('mouse');
			}).mousemove(function(e) {
				if($('html').hasClass('mouse')){return;}
				$('html').addClass('mouse').removeClass('keyboard');
			});

			$(window).resize(function(){
				iaHeaderNav.reSize();
				if (window.innerWidth <= 1023) {
					if($("#navigationTag").val() === '')
				{
					$(".iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__nav-l2").addClass("errorpage");
					$(".iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .iah__search").addClass("searchheight");
				}
					// adding new class for changing L1 nav view
					((iaHeaderNav.getBrand() === "natwest") && iaHeaderNav.getNavId() !== "us" || iaHeaderNav.isChampion()) ? $('.ia__main-content').addClass('horizontal-view') : $('.ia__main-content').removeClass('horizontal-view');				
					$('.iah a.iah__l4-column-title').removeAttr('tabindex').attr("aria-expanded", "false");
				} else {
					//$('.ia__main-content').removeClass('horizontal-view');
					$('.ia__navbar-nav__l2 li').find('a').removeAttr('tabindex');
					$('.iah a.iah__l4-column-title').attr('tabindex', '-1').removeAttr("aria-expanded");
				}
				if(window.innerWidth>=1024) {
					$('.iah__nav-l2 .iah__nav-l3 .iah__l3-column-holder .iah__l4-column-holder .iah__l4-column-title').attr('tabindex','-1');
				}
				else {
					$('.iah__nav-l2 .iah__nav-l3 .iah__l3-column-holder .iah__l4-column-holder:first-child .iah__l4-column-title').attr("tabindex", "0")
				}
			});
        }
	};
	var contentpath = ($('.iah__share').attr("data-contentpath"))? $('.iah__share').attr("data-contentpath") : 'path';
	if (contentpath.search('/content/rbs_com/en_uk/rbs') != -1 || contentpath.search('/content/natwestgroup_com/en_uk/natwestgroup') != -1){
		(function($) {
				   var url = 'https://irs.tools.investis.com/Clients/uk/rbs2/xml/xml.aspx?format=json&callback=?';

					$.ajax({
						 type: 'GET',
						 url: url,
						 async: false,
						 jsonpCallback: 'myJsonMethod',
						 contentType: "application/json",
						 dataType: 'jsonp',
						 cache:true,
						 success: function (json) {
							  var response = json.shareprice,
								 $CurrentPrice = response.last_trade_price,
								 $Symbol = response.symbol,
							     $Date = response.date,
								 $Time= response.time,
								 $resTimeSplit= $Time.slice(0,5),
								 $change = response.change;
								 if (parseFloat($change) < 0){
									 $('.ia__nav.ia__navbar-nav, .share_price').addClass('share_down');
								 }else{
									 $('.ia__nav.ia__navbar-nav, .share_price').removeClass('share_down');
								 }

                             $(".share_price").append(
                             	"<span class='sharePrice'>" +"LSE <span class='current-price'>" + $CurrentPrice+ "p</span> "+$change+" </span> <span> "+"Updated "+$resTimeSplit+"</span>"
							);
                            $('.ia__nav.ia__navbar-nav').removeClass("ia__noprice"); 
							$('li.share_price.mobile').removeClass("ia__noprice");
						 },
						 error: function(e) {
							console.log(e.message);
						 }
					});

			   })(jQuery);

    }
	$(document).ready(function(){
		iaHeaderNav.init();
		if(iaHeaderNav.isSmallMedium() && (iaHeaderNav.getBrand() === "natwest") && iaHeaderNav.getNavId() !== "us" || iaHeaderNav.isChampion()){// adding new class for changing L1 nav view
			$('.ia__main-content').addClass('horizontal-view');
			if($("#navigationTag").val() === '')
				{
					$(".iah .horizontal-view .iah__container .iah__l2__main-links .iah__l1__l2__holder .iah__nav-l2").addClass("errorpage");
					$(".iah .horizontal-view .iah__container .iah__l2__main-links .loginbus .iah__search").addClass("searchheight");
				}
			$('.ia__nav.ia__navbar-nav__l2 > li').each(function () {//code for removing chevron where l3 and l4 not there
				if (!$(this).find('.ia__navbar-nav__l3 > li').length) {
					$(this).find("a").css("background", "none");										
				}
			})
			$('.ia__nav.ia__navbar-nav__l3 > li').each(function () {
				if (!$(this).find('.ia__nav.ia__navbar-nav__l4 > li').length) {
					$(this).find("a").css("background", "none");
				}
			})
							
		}
		else{
			$('.ia__main-content').removeClass('horizontal-view');
		}
        if (!(iaHeaderNav.getBrand() === "natwest") && (($('#navigationTag').val() !== 'nav:natwestus/us') || iaHeaderNav.isChampion())) { //hiding any other brand except natwest
			$('.header-top-mobile').addClass('hide-div');
			$('.back-to-menu').addClass('hide-div');
			$('.search-mobile-icon').addClass('hide-div');
		}
		// if (globalUtil.isXlarge() && digitalData.site.brand === 'NATWESTGROUP_COM' && iaHeaderNav.isChampion()) {
        //     $('.ia__nav.ia__navbar-nav__l2 > li').each(function () {
        //         if ($(this).find('.ia__navbar-nav__l3 > li').length) {
        //             $(this).find("a[data-level='l2']").addClass('dropdown-arrow-l2');
        //         }
        //     });
        //     $('.ia__nav.ia__navbar-nav__l3 > li').each(function () {
        //         if ($(this).find('.ia__navbar-nav__l4 > li').length) {
        //             $(this).find("a[data-level='l3']").addClass('dropdown-arrow-l3');
        //         }
        //     });
        // }

		$(document).on("keyup", function (e) {
			var al = document.activeElement;
			if (e.shiftKey && e.keyCode === 9) {
				if ($(".iah__l1__l2__holder").find("button.iah__menu-link").hasClass("acc")) {
					$(".iah__l1__l2__holder").find("button.iah__menu-link").focus();
					$(".iah__l1__l2__holder").find("button.iah__menu-link").removeClass("acc")
				}
			} else if (e.keyCode === 9) {
				if ($(".iah__l1__l2__holder").attr("aria-hidden") === 'true' && $(".iah__l1__l2__holder").find("button.iah__menu-link").hasClass("btnacc")) {
					$('.back-to-menu-link').focus();
					$(".iah__l1__l2__holder").find("button.iah__menu-link").removeClass("btnacc")
				}
			}
		}).on("keydown", function (e) {
			var al = document.activeElement;
			if (e.shiftKey && e.keyCode === 9) {
				if (al.classList.contains('back-to-menu-link') === true) {
					$(".iah__l1__l2__holder").find("button.iah__menu-link").addClass("acc");
				}
		
			}else if (e.keyCode === 9) {
				if ($(".iah__l1__l2__holder").attr("aria-hidden") === 'true' && al.classList.contains('iah__menu-link') === true) {
					$(".iah__l1__l2__holder").find("button.iah__menu-link").addClass("btnacc");
				}
			}
		});
		$(".iah__nav-l2 li>a").each(function() {
			if($(this).attr("href")==undefined) {
				$(this).attr("href", "javascript:void(0)");
			}
		});
		$(".responsive_natwest_group .iah__nav-l2 li>a").each(function() {
			if($(this).attr("href")!="#" && $(this).attr("href")!="javascript:void(0)") {
				$(this).closest("li").addClass("haslink");
				$(this).addClass("linktag");
				$(this).siblings(".chevron-wrapper").find(".chevron-icon").addClass("hasdropdown").attr("tabindex", "0");
				$(this).removeAttr("aria-haspopup").removeAttr("aria-expanded");
			}
			else {
				$(this).closest("li").addClass("hasnolink");
				$(this).addClass("nolinktag");
			}
		});
		
		$(".responsive_natwest_group .chevron-icon.hasdropdown").on("click keyup", function(e) {
			var thisele=$(this),
			chevronlabel=$(this).closest(".chevron-wrapper").siblings("a").text() + " submenu";
			if(e.type=="click" || (e.keyCode==13 && window.innerWidth>=1024)) {
				if($(this).closest("li").find(".linktag").attr("data-level")=="l2") {
					iaHeaderNav.l3Open($(this).closest("li").find(".linktag"));
					iaHeaderNav.overlayController();
					iaHeaderNav.l4SideBorderquilizer();
				}
				if($(this).closest("li").find(".linktag").attr("data-level")=="l3") {
					iaHeaderNav.l4Open($(this).closest("li").find(".linktag"));
					iaHeaderNav.l4SideBorderquilizer();
				}
				if($(this).closest("li").find('ul li:visible').length>0) {
					$(this).addClass("dropdown-opened");
					$(this).attr("aria-label", chevronlabel + " expanded");
				}
				else {
					setTimeout(function() {
						thisele.removeClass("dropdown-opened");
					}, 500);
					$(this).attr("aria-label", chevronlabel + " collapsed");
				}
				$(this).closest("li").find("a").removeAttr("aria-expanded");
			}
		});
	
		$(".responsive_natwest_group .haslink a").on("click", function(e) {
			if(window.innerWidth >= 1024) {
				if(!$(this).find(".chevron-icon").hasClass("dropdown-opened")) {
					window.location.href = $(this).attr("href");
				}
			}
		});
		
	});

})();
$(document).ready(function(){
	/* NW US IA Nav fix */
    var stylesheet = $('link[rel="stylesheet"]').attr('href'),
        isChampion = stylesheet.indexOf("clientlib_base_champion") > 0;
	if($('#navigationTag').val() === 'nav:natwestus/us' && !isChampion){
		$('.search-mobile-icon').hide();
		$('.header-top-mobile, .back-to-menu').removeClass('visible-xs visible-sm').hide();		
		if(window.innerWidth > 767 && window.innerWidth < 1024){
			$('.header-top-mobile + .iah__menu-link.menu-open').hide();
		}				
	}
	// Business Login scripts
	$(".iah__login-link").click(function () {
		var iaLoginDropdown = $(this).parent().find('.iah__login__dropdown');
		if(iaLoginDropdown.hasClass('active')){
			iaLoginDropdown.removeClass('active');
			$(this).attr("aria-expanded", "false");
			$(".iah .horizontal-view .iah__login__dropdown.active .back-to-menu").removeClass('removebackoption');// removing backtomenu option from login
		}else{
			iaLoginDropdown.addClass('active');
			$(this).attr("aria-expanded", "true");
			$(".iah .horizontal-view .iah__login__dropdown.active .back-to-menu").addClass('removebackoption');// adding backtomenu option from login
		}
		if ($('.ia__navbar-nav__l2 .ia-active').length) {
			iaHeaderNav.l3Close();
		}
	});
	$(document).on("click touchstart", function (e) {
		var $login_btn = $(".iah__login_l1, .iah__container .iah__login");
		if (!$login_btn.is(e.target) && $login_btn.has(e.target).length === 0) {
			if( $(".iah__login__dropdown").length > 0){
				$(".iah__login__dropdown").removeClass("active");
				$(".iah__login-link").attr("aria-expanded", "false");				 
			}

		}
	});
	// KeyUp Event Functionality for Business Login
	$(".ia__main-content").on("keyup", function (e) {
		if($('.iah__login,.iah__login_l1').has(e.target).length === 0 && $('.iah__login__dropdown').hasClass('active')){
			$('.iah__login__dropdown').removeClass('active');
			$(".iah__login-link").attr("aria-expanded", "false");
		}
	});
    $(".ia__navbar-nav__l2 .iah__nav-l3 ul li.show__levelfour").each(function () {
		$(this).closest(".iah__nav-l3").parent().addClass("hide-l3");

    });
    /* Grouping L4 Nav Heading list accesibility fix */
	$(".iah__l4-column-holder").each(function(){
		let thisele=$(this);
        const $title = thisele.find('.iah__l4-column-title');
		const listCount = thisele.find('ol li').length;
        const $firstListItem = thisele.find('ol li:first-child a');
        thisele.find('ol').attr('aria-label',`grouping ${$title.text().trim()}`);
		thisele.find('ol li a').on('focus', function(){
			const text = thisele.text().trim();
			thisele.attr('aria-label', text);
		});
		setTimeout(function(){
			$firstListItem.trigger('focus');
		},0);
	});
	if(window.innerWidth>=1024) {
		$('.iah__nav-l2 .iah__nav-l3 .iah__l3-column-holder .iah__l4-column-holder .iah__l4-column-title').attr('tabindex','-1');
	}
	else {
		$('.iah__nav-l2 .iah__nav-l3 .iah__l3-column-holder .iah__l4-column-holder:first-child .iah__l4-column-title').attr("tabindex", "0")
	}

});
/*
 * This script is for Analytics event tracking.
 * The below function is used for triggering on click event for Global header Component.
 */
$(document).ready(function () {

    $('header a').off('click.headerDTMClick').on('click.headerDTMClick', function () {
        var value = $.trim($(this).text()),
            id = $(this).attr('id') ? $(this).attr('id') : '',
            linkUrl = $(this).attr('href');
        try {
            globalUtil.triggerDtmScript('link', 'Global nav', value, 'Header Navigation', id, linkUrl);
        } catch (e) {

        }
    });

});
